(function(d,e){typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(d=typeof globalThis<"u"?globalThis:d||self,e(d.webxrWebAR={}))})(this,function(d){"use strict";const e={arleneStateCallbacks:[],arlenePersistentStateCallbacks:[],lastPersistentState:void 0,arleneInstanceId:Math.round(Math.random()*Math.pow(10,15)),sendMessage:s=>{s.instanceId=e.arleneInstanceId,delete s.idReferrer,window.top.postMessage({sender:"arleneIframe",message:s},"*")}},r={iFrames:[],sendMessage:s=>{const a=s.idReferrer;s.instanceId=e.arleneInstanceId;let t;if(a)t=r.iFrames.find(n=>n.dataset.regId===a);else{if(r.iFrames.length===0)throw"Can't call window.arleneFrame since you have no webXR iFrames registered";if(r.iFrames.length>1)throw"Can't call window.arleneFrame directly if you have more than one webXR iFrame";t=r.iFrames[0]}t.contentWindow.postMessage({sender:"arleneChildIframe",message:s},"*")}};function l(){function s(a,t){return a.arleneStateCallbacks=[],a.arlenePersistentStateCallbacks=[],a.changeModel=(n,i)=>{a.sendMessage({command:"changeModel",params:n,value:i,idReferrer:t})},a}s(e),s(r),window.onmessage=function(a){try{if(a.data.sender==="arleneEmbeddedIframe"&&a.data.message.command==="registerChildIframe"){const n=Array.from(document.getElementsByTagName("iframe")).find(i=>i.src===a.data.src&&i.dataset.regId===void 0);n.dataset.regId=a.data.arleneInstanceId,n.webxrWebAR={child:s({sendMessage:r.sendMessage},n.dataset.regId)},r.iFrames.push(n);return}if(a.data.sender==="arlene"&&a.data.instanceId===e.arleneInstanceId){let t=a.data.message;if(t.command==="refreshState")for(let n of e.arleneStateCallbacks)n(e,t.state);if(t.command==="refreshPersistentState"){e.lastPersistentState=t.persistentState;for(let n of e.arlenePersistentStateCallbacks)n(e,t.persistentState)}t.command==="isAudioPlaying"&&e.tempAudioCallback(t.isAudioPlaying)}}catch(t){console.error(t)}},e.sendMessage({command:"affiliateIframe"})}l(),window.webxrWebAR={parent:e,child:r},d.child=r,d.parent=e,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
